<!DOCTYPE html>
<html>
<head>
  <title>SyncIt.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "home/fozz/Projects/syncit//SyncIt.js", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h2">
        <a href="#syncit">SyncIt</a>
      </div>
      <div class="heading h3">
        <a href="#new%20syncit()">new SyncIt()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.setclonefunction()">SyncIt.setCloneFunction()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getmodifier()">SyncIt.getModifier()</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.islocked()">SyncIt.isLocked()</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listen()">SyncIt.listen()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.removealllisteners()">SyncIt.removeAllListeners()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.removelistener()">SyncIt.removeListener()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h4">
        <a href="#returns">Returns</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenforaddedtoqueue()">SyncIt.listenForAddedToQueue()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenforapplied()">SyncIt.listenForApplied()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.listenforfed()">SyncIt.listenForFed()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.set()">SyncIt.set()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.remove()">SyncIt.remove()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.update()">SyncIt.update()</a>
      </div>
      <div class="heading h4">
        <a href="#example">Example</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.feed()">SyncIt.feed()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.apply()">SyncIt.apply()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.get()">SyncIt.get()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getfull()">SyncIt.getFull()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getdatasetnames()">SyncIt.getDatasetNames()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.getdatakeysindataset()">SyncIt.getDatakeysInDataset()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit.removestalefromqueue()">SyncIt.removeStaleFromQueue()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>SyncIt.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="cm">/* jshint strict: true, smarttabs: true, es3: true, forin: true, immed: true, latedef: true, newcap: true, noarg: true, undef: true, unused: true, es3: true, bitwise: false, curly: true, latedef: true, newcap: true, noarg: true, noempty: true */</span>

<span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">factory</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// UMD from https://github.com/umdjs/umd/blob/master/returnExports.js</span>
  <span class="cm">/* jshint strict: false */</span>
  <span class="cm">/* globals module: false, require: false, define: true */</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span>
      <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./Constant.js&#39;</span><span class="p">),</span>
      <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./updateResult.js&#39;</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">define</span><span class="p">(</span>
      <span class="p">[</span><span class="s1">&#39;syncit/Constant&#39;</span><span class="p">,</span> <span class="s1">&#39;syncit/updateResult&#39;</span><span class="p">],</span>
      <span class="nx">factory</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">SyncIt</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span>
      <span class="nx">root</span><span class="p">.</span><span class="nx">SyncIt_Constant</span><span class="p">,</span>
      <span class="nx">root</span><span class="p">.</span><span class="nx">SyncIt_updateResult</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">})(</span><span class="k">this</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">,</span> <span class="nx">updateResult</span><span class="p">)</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

<span class="kd">var</span> <span class="nx">_filter</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span><span class="nx">filterFunc</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">filterFunc</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit">
  <h2>
    <a href="#syncit" name="syncit" class="pilcrow">&#182;</a>
    SyncIt
  </h2>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="new%20syncit()">
  <h3>
    <a href="#new%20syncit()" name="new%20syncit()" class="pilcrow">&#182;</a>
    new SyncIt()
  </h3>
</div>


<p>Constructor</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Store} <code>store</code></strong> Used to store data which is known to be synced onto the <em>Server</em>.</li>
<li><strong>@param {Queue} <code>queue</code></strong> Used to store data which is still to be synced to the <em>Server</em>.</li>
<li><strong>@param {Modifier} <code>modifier</code></strong> The UNIQUE User/Device which is using the instance of SyncIt.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">SyncIt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">store</span><span class="p">,</span> <span class="nx">queue</span><span class="p">,</span> <span class="nx">modifier</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_store</span> <span class="o">=</span> <span class="nx">store</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_queue</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_modifier</span> <span class="o">=</span> <span class="nx">modifier</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_events</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;added_to_queue&#39;</span><span class="o">:</span> <span class="p">[],</span>
    <span class="s1">&#39;applied&#39;</span><span class="o">:</span> <span class="p">[],</span>
    <span class="s1">&#39;fed&#39;</span><span class="o">:</span> <span class="p">[]</span>
  <span class="p">};</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">ob</span><span class="p">));</span> <span class="p">};</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.setclonefunction()">
  <h3>
    <a href="#syncit.setclonefunction()" name="syncit.setclonefunction()" class="pilcrow">&#182;</a>
    SyncIt.setCloneFunction()
  </h3>
</div>

  </div>
  <div class="body"><p>Sometimes, SyncIt wants a deep copy of an Object, this function will allow 
you to change what function does that deep copying.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>

  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cloneFunction
</span>
      <span class="dox_type">Function</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setCloneFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cloneFunction</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span> <span class="o">=</span> <span class="nx">cloneFunction</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getmodifier()">
  <h3>
    <a href="#syncit.getmodifier()" name="syncit.getmodifier()" class="pilcrow">&#182;</a>
    SyncIt.getModifier()
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Modifier}</strong> The User/Device which is using the instance of SyncIt.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getModifier</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_modifier</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.islocked()">
  <h3>
    <a href="#syncit.islocked()" name="syncit.islocked()" class="pilcrow">&#182;</a>
    SyncIt.isLocked()
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Boolean}</strong> SyncIt will use an internal lock to deny changes while engaged in modifications to either the <em>Queue</em> or the <em>Store</em>. This function will return <code>true</code> if SyncIt is locked.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isLocked</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listen()">
  <h3>
    <a href="#syncit.listen()" name="syncit.listen()" class="pilcrow">&#182;</a>
    SyncIt.listen()
  </h3>
</div>

  </div>
  <div class="body"><p>The following events are emitted by SyncIt.</p>

<ul>
<li>added_to_queue - See <a href="#syncit.listenforaddedtoqueue--">SyncIt.listenForAddedToQueue()</a></li>
<li>applied - See <a href="#syncit.listenforapplied--">SyncIt.listenForApplied()</a></li>
<li>fed - See <a href="#syncit.listenforfed--">SyncIt.listenForFed()</a></li>
</ul>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the event to listen for</li>
<li><strong>@param {Function} <code>listener</code></strong> The listener to fire when event occurs.</li>
</ul>


<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Boolean}</strong> True if that event is available to listen to.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">propertyNames</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">})(</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">propertyNames</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">listener</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.removealllisteners()">
  <h3>
    <a href="#syncit.removealllisteners()" name="syncit.removealllisteners()" class="pilcrow">&#182;</a>
    SyncIt.removeAllListeners()
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the event you want to remove all listeners for.</li>
</ul>


<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Array}</strong> The listeners that have just been removed.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeAllListeners</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">propertyNames</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">})(</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">propertyNames</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">[];</span>
  <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">event</span><span class="p">];</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.removelistener()">
  <h3>
    <a href="#syncit.removelistener()" name="syncit.removelistener()" class="pilcrow">&#182;</a>
    SyncIt.removeListener()
  </h3>
</div>

  </div>
  <div class="body"><p>Removes a specific listener from an event.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the event you want to remove a listener from.</li>
<li><strong>@param {Function} <code>listener</code></strong> The listener you want to remove.</li>
</ul>


<div class="pilwrap" id="returns">
  <h4>
    <a href="#returns" name="returns" class="pilcrow">&#182;</a>
    Returns
  </h4>
</div>


<ul>
<li><strong>@return {Boolean}</strong> True if the listener was removed, false otherwise.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeListener</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">replacement</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">successful</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">propertyNames</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">})(</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">propertyNames</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">event</span><span class="p">][</span><span class="nx">i</span><span class="p">]</span> <span class="o">!==</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">replacement</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">event</span><span class="p">][</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
      <span class="nx">successful</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">event</span><span class="p">]</span> <span class="o">=</span> <span class="nx">replacement</span><span class="p">;</span>
  
  <span class="k">return</span> <span class="nx">successful</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenforaddedtoqueue()">
  <h3>
    <a href="#syncit.listenforaddedtoqueue()" name="syncit.listenforaddedtoqueue()" class="pilcrow">&#182;</a>
    SyncIt.listenForAddedToQueue()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is added to the <em>Queue</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(operation, dataset, datakey)</code>.
<ul><li><strong>@param {Dataset} <code>listener.dataset</code></strong> The <em>dataset</em> of the updated.</li>
<li><strong>@param {Datakey} <code>listener.datakey</code></strong> The <em>datakey</em> that was updated.</li>
<li><strong>@param {Queueitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> that was just added.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForAddedToQueue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;added_to_queue&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenforapplied()">
  <h3>
    <a href="#syncit.listenforapplied()" name="syncit.listenforapplied()" class="pilcrow">&#182;</a>
    SyncIt.listenForApplied()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is applied to the <em>Store</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(queueitem, newStorerecord)</code>.
<ul><li><strong>@param {Dataset} <code>listener.dataset</code></strong> The <em>dataset</em> of the applied.</li>
<li><strong>@param {Datakey} <code>listener.datakey</code></strong> The <em>datakey</em> that was.applied.</li></ul></li>
<li><strong>@param {Queueitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> that was applied.</li>
<li><strong>@param {Storerecord} <code>listener.newStorerecord</code></strong> The <em>storerecord</em> which is now stored.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForApplied</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;applied&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>



</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.listenforfed()">
  <h3>
    <a href="#syncit.listenforfed()" name="syncit.listenforfed()" class="pilcrow">&#182;</a>
    SyncIt.listenForFed()
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a listener for when data is fed using <a href="#syncit.feed--">SyncIt.feed()</a></p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Signature: <code>function(queueitem, newStorerecord)</code>.
<ul><li><strong>@param {String} <code>listener.dataset</code></strong> The dataset of the just fed Queueitem.</li>
<li><strong>@param {String} <code>listener.datakey</code></strong> The datakey of the just fed Queueitem.</li></ul></li>
<li><strong>@param {Queueitem} <code>listener.queueitem</code></strong> The <em>queueitem</em> that was applied.</li>
<li><strong>@param {Storerecord} <code>listener.newStorerecord</code></strong> The <em>storerecord</em> which is now stored.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForFed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;fed&#39;</span><span class="p">,</span> <span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.set()">
  <h3>
    <a href="#syncit.set()" name="syncit.set()" class="pilcrow">&#182;</a>
    SyncIt.set()
  </h3>
</div>

  </div>
  <div class="body"><p>Will add a <em>Queueitem</em> to the <em>Queue</em> that represents a complete overwrite of any existing data.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Update} <code>update</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Fired after the <em>Queue</em> has been updated. See <a href="#syncit._addtoqueue--">SyncIt._addToQueue()</a>** for documentation.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">set</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToQueue</span><span class="p">(</span>
    <span class="s1">&#39;set&#39;</span><span class="p">,</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="nx">update</span><span class="p">,</span>
    <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">(),</span>
    <span class="kc">false</span><span class="p">,</span>
    <span class="nx">whenAddedToQueue</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.remove()">
  <h3>
    <a href="#syncit.remove()" name="syncit.remove()" class="pilcrow">&#182;</a>
    SyncIt.remove()
  </h3>
</div>

  </div>
  <div class="body"><p>This will add a Queueitem to the Queue that represents the removal of data stored at a Dataset/Datakey.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Fired after the <em>Queue</em> has been updated. See <a href="#syncit._addtoqueue--">SyncIt._addToQueue()</a>** for documentation.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">remove</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToQueue</span><span class="p">(</span>
    <span class="s1">&#39;remove&#39;</span><span class="p">,</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="p">{},</span>
    <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">(),</span>
    <span class="kc">false</span><span class="p">,</span>
    <span class="nx">whenAddedToQueue</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.update()">
  <h3>
    <a href="#syncit.update()" name="syncit.update()" class="pilcrow">&#182;</a>
    SyncIt.update()
  </h3>
</div>

  </div>
  <div class="body"><p>This can update one or more parts of the the data at a single <em>dataset</em> / <em>datakey</em> using something similar to the MongoDB update syntax.</p>


<div class="pilwrap" id="example">
  <h4>
    <a href="#example" name="example" class="pilcrow">&#182;</a>
    Example
  </h4>
</div>


<div class='highlight'><pre><code language=''>syncIt.update(
    'user',
    'jack',
    {'$set': {'eyes.color': 'blue'}},
    function(err, dataset, datakey, queueitem) {
        // The data now includes { eyes: { color: "blue" } } but the rest of
        // the data has been preserved
    }
);
</code></pre></div>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Update} <code>update</code></strong></li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Fired after the <em>Queue</em> has been updated. See <a href="#syncit._addtoqueue--">SyncIt._addToQueue()</a> for documentation.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">update</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_addToQueue</span><span class="p">(</span>
    <span class="s1">&#39;update&#39;</span><span class="p">,</span>
    <span class="nx">dataset</span><span class="p">,</span>
    <span class="nx">datakey</span><span class="p">,</span>
    <span class="nx">update</span><span class="p">,</span>
    <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">(),</span>
    <span class="kc">false</span><span class="p">,</span>
    <span class="nx">whenAddedToQueue</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.feed()">
  <h3>
    <a href="#syncit.feed()" name="syncit.feed()" class="pilcrow">&#182;</a>
    SyncIt.feed()
  </h3>
</div>

  </div>
  <div class="body"><p>This function is for feeding in external Queueitem from the <em>Respository</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Array} <code>feedQueueitems</code></strong> These are the items which are being fed from the <em>Server</em>.</li>
<li><strong>@param {Function} <code>resolutionFunction</code></strong> Called when conflict occurs, Signature: <code>function(dataset, datakey, storerecord, serverQueueitems, localQueueitems, resolved)</code>.
<ul><li><strong>@param {Array} <code>resolutionFunction.dataset</code></strong> The <em>Dataset</em> of the conflict.</li>
<li><strong>@param {Array} <code>resolutionFunction.datakey</code></strong> The <em>Datakey</em> of the conflict.</li>
<li><strong>@param {Array} <code>resolutionFunction.storerecord</code></strong> What is in the local <em>Store</em> for that <em>Dataset</em> / <em>Datakey</em>.</li>
<li><strong>@param {Array} <code>resolutionFunction.localQueueitems</code></strong> The <em>Queueitem</em> that has been added using functions such as <a href="#syncit.set--">SyncIt.set()</a> but is now conflicting with the data from the <em>Server</em>.</li>
<li><strong>@param {Array} <code>resolutionFunction.serverQueueitems</code></strong> The extra <em>Queueitem</em> that are on the Server.</li>
<li><strong>@param {Function} <code>resolutionFunction.resolved</code></strong> This should be called from inside resolutionFunction and will add <em>Queueitem</em> after the <em>Server</em> supplied <em>Queueitem</em>. Signature: <code>function(resolved, mergedLocalsToApplyAfterwards)</code>
<ul><li><strong>@param {Boolean} <code>resolutionFunction.resolved.resolved</code></strong> use false to halt the feeding, true otherwise</li>
<li><strong>@param {Array} <code>resolutionFunction.resolved.mergedLocalsToApplyAfterwards</code></strong> These will be added to the <em>Queue</em> <strong>after</strong> (currently) all serverQueueitems have been applied to the <em>Store</em>.</li></ul></li></ul></li>
<li><strong>@param {Function} <code>feedDone</code></strong> Callback for when done. Signature: <code>function(err, fedItemsFailed, conflictResolutionQueueitemFailed, resultingStorerecord)</code>;
<ul><li><strong>@param {Errorcode} <code>feedDone.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Array} <code>feedDone.fedItemsFailed</code></strong> Array of items fed from the <em>Server</em> which could not be processed.</li>
<li><strong>@param {Array} <code>feedDone.conflictResolutionQueueitemFailed</code></strong> Array of items created in conflict resolution (using <code>resolutionFunction.resolved</code>) which have failed to be added to the local <em>Queue</em>.</li>
<li><strong>@param {Storerecord} <code>feedDone.resultingStorerecord</code></strong> What is now stored on the Store.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">feed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">feedQueueitems</span><span class="p">,</span> <span class="nx">resolutionFunction</span><span class="p">,</span> <span class="nx">feedDone</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">inst</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Make a shallow copy of feedQueueitems so when we <code>shift()</code> we are not
fiddling with users data.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="kd">var</span> <span class="nx">applyQueue</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">items</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">items</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">items</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">})(</span><span class="nx">feedQueueitems</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>It could be that you're feeding (some) of your own Queueitem.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="nx">applyQueue</span> <span class="o">=</span> <span class="nx">_filter</span><span class="p">(</span><span class="nx">applyQueue</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">m</span> <span class="o">==</span> <span class="k">this</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">())</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  
  <span class="kd">var</span> <span class="nx">allLocalToApplyAfterwards</span> <span class="o">=</span> <span class="p">[];</span>
  
  <span class="kd">var</span> <span class="nx">prepareServerQueueItemForResolutionFunction</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span> <span class="nx">applyQueue</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">firstQueueitem</span> <span class="o">=</span> <span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
    
    <span class="kd">var</span> <span class="nx">filterFunc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">elem</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">storerecord</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="p">(</span><span class="nx">elem</span><span class="p">.</span><span class="nx">b</span> <span class="o">&gt;=</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span><span class="p">);</span>
    <span class="p">};</span>
    
    <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">applyQueue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span>
        <span class="p">(</span><span class="nx">applyQueue</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">s</span> <span class="o">!=</span> <span class="nx">firstQueueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">)</span> <span class="o">||</span>
        <span class="p">(</span><span class="nx">applyQueue</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">k</span> <span class="o">!=</span> <span class="nx">firstQueueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">)</span>
      <span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_filter</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">filterFunc</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">applyQueue</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">_filter</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="nx">filterFunc</span><span class="p">);</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">unlockAndError</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">FEEDING</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
      <span class="nx">err</span><span class="p">,</span>
      <span class="nx">applyQueue</span><span class="p">,</span>
      <span class="nx">allLocalToApplyAfterwards</span>
    <span class="p">);</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">addToStoreAndContinue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">applyQueue</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">inst</span><span class="p">.</span><span class="nx">_addQueueitemToStore</span><span class="p">(</span><span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">appliedQueueitem</span><span class="p">,</span> <span class="nx">storerecord</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">applyQueue</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">applyQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;fed&#39;</span><span class="p">,</span> <span class="nx">appliedQueueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span> <span class="nx">appliedQueueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span> <span class="nx">appliedQueueitem</span><span class="p">,</span> <span class="nx">storerecord</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">feedOne</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">};</span>
    
  <span class="kd">var</span> <span class="nx">fireConflictResolution</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span> <span class="nx">applyQueue</span><span class="p">,</span> <span class="nx">queueitemInQueue</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="kd">var</span> <span class="nx">queueitemInQueueAndPreviousLocalsToApplyAfterwards</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queueitemInQueue</span><span class="p">,</span><span class="nx">localsAfterwards</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

      <span class="kd">var</span> <span class="nx">addArray</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">ar</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">ar</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">ar</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
      <span class="p">};</span>

      <span class="nx">addArray</span><span class="p">(</span><span class="nx">queueitemInQueue</span><span class="p">);</span>
      <span class="nx">addArray</span><span class="p">(</span><span class="nx">localsAfterwards</span><span class="p">);</span>

      <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
    <span class="p">};</span>

    <span class="nx">resolutionFunction</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
      <span class="nx">inst</span><span class="p">,</span>
      <span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
      <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="nx">storerecord</span><span class="p">,</span>
      <span class="nx">queueitemInQueueAndPreviousLocalsToApplyAfterwards</span><span class="p">(</span>
        <span class="nx">queueitemInQueue</span><span class="p">,</span>
        <span class="nx">allLocalToApplyAfterwards</span>
      <span class="p">),</span>
      <span class="nx">prepareServerQueueItemForResolutionFunction</span><span class="p">(</span>
        <span class="nx">storerecord</span><span class="p">,</span>
        <span class="nx">applyQueue</span>
      <span class="p">),</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">resolved</span><span class="p">,</span> <span class="nx">localsToApplyAfterwards</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">resolved</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">FEEDING</span><span class="p">);</span>
          <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
            <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">NOT_RESOLVED</span><span class="p">,</span>
            <span class="nx">applyQueue</span><span class="p">,</span>
            <span class="nx">allLocalToApplyAfterwards</span>
          <span class="p">);</span>
        <span class="p">}</span>
        
        <span class="k">while</span> <span class="p">(</span><span class="nx">localsToApplyAfterwards</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">v</span> <span class="o">=</span> <span class="nx">localsToApplyAfterwards</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
          <span class="nx">v</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">();</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">v</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">))</span> <span class="p">{</span>
            <span class="nx">v</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
          <span class="p">}</span>
          <span class="nx">v</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
          <span class="nx">allLocalToApplyAfterwards</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">v</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">feedOne</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">queueitemsRetrieved</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">queueitemInQueue</span><span class="p">,</span> <span class="nx">removeSameDatasetDatakeyFromQueue</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="nx">queueitemInQueue</span><span class="p">.</span><span class="nx">sort</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">localQiA</span><span class="p">,</span> <span class="nx">localQiB</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">localQiA</span><span class="p">.</span><span class="nx">b</span> <span class="o">-</span> <span class="nx">localQiB</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span>
    <span class="p">});</span>
    
    <span class="kd">var</span> <span class="nx">removeQueueitemInQueueForDatasetDatakeyAndStore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">_removeByDatasetAndDatakey</span><span class="p">(</span>
        <span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
        <span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
        <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">applyQueue</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">addToStoreAndContinue</span><span class="p">(</span><span class="nx">applyQueue</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">);</span>
    <span class="p">};</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">applyQueue</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">queueitemInQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">addToStoreAndContinue</span><span class="p">(</span><span class="nx">applyQueue</span><span class="p">);</span>
    <span class="p">}</span>
    
    

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>If conflict resolution has already cleared, we remove items in 
the same Dataset / Datakey</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
    <span class="k">if</span> <span class="p">(</span><span class="nx">removeSameDatasetDatakeyFromQueue</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">removeQueueitemInQueueForDatasetDatakeyAndStore</span><span class="p">();</span>
    <span class="p">}</span>
    
    <span class="nx">inst</span><span class="p">.</span><span class="nx">_store</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span>
      <span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">storerecord</span><span class="p">)</span> <span class="p">{</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>It is quite likely that we are feeding data into a 
dataset / datakey that does not already exist.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">storerecord</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>It might be that we are trying to feed data which is 
based on an old storerecord, if we are just skip over it</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">applyQueue</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
          <span class="k">return</span> <span class="nx">feedOne</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
        <span class="p">}</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>It is possible we have stale items in our queue</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span>
          <span class="nx">queueitemInQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">&amp;&amp;</span> 
          <span class="p">(</span><span class="nx">queueitemInQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span><span class="p">)</span>
        <span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span>
            <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">STALE_FOUND_IN_QUEUE</span><span class="p">,</span>
            <span class="nx">applyQueue</span>
          <span class="p">);</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>It is quite possible all queueitem where stale, in which case just
go right ahead and process the fed queueitem!</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queueitemInQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">addToStoreAndContinue</span><span class="p">(</span><span class="nx">applyQueue</span><span class="p">);</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24">&#182;</a>
</div>
<p>If we have items in our local queue with a basedonversion which is
lower than what we are being fed, it is likely that we have unapplied
items which we have already uploaded.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queueitemInQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span> <span class="o">&lt;</span> <span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlockAndError</span><span class="p">(</span>
            <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">BASED_ON_IN_QUEUE_LESS_THAN_BASED_IN_BEING_FED</span><span class="p">,</span>
            <span class="nx">applyQueue</span>
          <span class="p">);</span>
        <span class="p">}</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25">&#182;</a>
</div>
<p>fire conflict resolution with the item shifted. It does
not matter because it will either succeed, removing all
Queueitem for that dataset / datakey or fail.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">fireConflictResolution</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span> <span class="nx">applyQueue</span><span class="p">,</span> <span class="nx">queueitemInQueue</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
    
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">addConflictResolvingQueueitemToQueue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">allLocalToApplyAfterwards</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">allLocalToApplyAfterwards</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
        <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span>
        <span class="p">[],</span>
        <span class="nx">allLocalToApplyAfterwards</span>
      <span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">inst</span><span class="p">.</span><span class="nx">_addToQueue</span><span class="p">(</span>
      <span class="nx">allLocalToApplyAfterwards</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">o</span><span class="p">,</span>
      <span class="nx">allLocalToApplyAfterwards</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">allLocalToApplyAfterwards</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
      <span class="nx">allLocalToApplyAfterwards</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">u</span><span class="p">,</span>
      <span class="nx">allLocalToApplyAfterwards</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">t</span><span class="p">,</span>
      <span class="kc">true</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">allLocalToApplyAfterwards</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
          <span class="k">return</span> <span class="nx">addConflictResolvingQueueitemToQueue</span><span class="p">(</span><span class="nx">allLocalToApplyAfterwards</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">feedDone</span><span class="p">(</span>
          <span class="nx">err</span><span class="p">,</span>
          <span class="p">[],</span>
          <span class="nx">allLocalToApplyAfterwards</span>
        <span class="p">);</span>
      <span class="p">}</span>
      
    <span class="p">);</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">feedOne</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">removeSameDatasetDatakeyFromQueue</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">applyQueue</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">FEEDING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">addConflictResolvingQueueitemToQueue</span><span class="p">(</span><span class="nx">allLocalToApplyAfterwards</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">inst</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">getItemsForDatasetAndDatakey</span><span class="p">(</span>
      <span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">applyQueue</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">queueitemInQueue</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">queueitemsRetrieved</span><span class="p">(</span>
          <span class="nx">err</span><span class="p">,</span>
          <span class="nx">queueitemInQueue</span><span class="p">,</span>
          <span class="nx">removeSameDatasetDatakeyFromQueue</span>
        <span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nx">l</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="nx">queueitemValidationError</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_locked</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
      <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">,</span>
      <span class="nx">feedQueueitems</span><span class="p">,</span>
      <span class="nx">allLocalToApplyAfterwards</span>
    <span class="p">);</span>
  <span class="p">}</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">feedQueueitems</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">queueitemValidationError</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_basicValidationForQueueitem</span><span class="p">(</span><span class="nx">feedQueueitems</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">queueitemValidationError</span> <span class="o">!=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">feedDone</span><span class="p">(</span>
        <span class="nx">queueitemValidationError</span><span class="p">,</span>
        <span class="nx">feedQueueitems</span><span class="p">,</span>
        <span class="nx">allLocalToApplyAfterwards</span>
      <span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">|</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">FEEDING</span><span class="p">;</span>
  
  <span class="nx">feedOne</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._emit()</strong></p>
  </div>
  <div class="body"><p>Emits an Event.</p>

<p><strong>Parameters</strong></p>

<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the Event you wish to emit.</li>
<li><strong>@param {} <code>param2, param3, ...</code></strong> Extra parameters will be passed to the event listener.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_emit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span> <span class="cm">/*, other arguments */</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">event</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="s2">&quot;SyncIt._emit(): Attempting to fire unknown event &#39;&quot;</span><span class="o">+</span><span class="nx">event</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_events</span><span class="p">[</span><span class="nx">event</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">};</span>

<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_basicValidationForQueueitem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">,</span><span class="nx">skips</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">DATASET_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATASET</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">DATAKEY_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_DATAKEY</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">o</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">OPERATION_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_OPERATION</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="nx">skips</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">skips</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">)</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">m</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">MODIFIER_REGEXP</span><span class="p">)</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">INVALID_MODIFIER</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._addToQueue()</strong></p>
  </div>
  <div class="body"><p>Adds a Queueitem to the Queue.</p>

<p><strong>Parameters</strong></p>

<ul>
<li><strong>@param {Operation} <code>operation</code></strong></li>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Update} <code>update</code></strong></li>
<li><strong>@param {Modifier} <code>modifier</code></strong></li>
<li><strong>@param {Basedonversion} <code>basedonversion</code></strong></li>
<li><strong>@param {Modificationtime} <code>modificationtime</code></strong></li>
<li><strong>@param {Boolean} <code>allowFeedLock</code></strong> Usually adding to the <em>Queue</em> would be denied when feeding, but <a href="#syncit.feed--">SyncIt.feed()</a> itself can add items to the <em>Queue</em> this parameter will enable that posibility.</li>
<li><strong>@param {Function} <code>whenAddedToQueue</code></strong> Callback for when adding is complete. Signature: <code>function(errorCode, dataset, datakey, queueitem)</code>
<ul><li><strong>@param {Errorcode} <code>whenAddedToQueue.errorCode</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Dataset} <code>whenAddedToQueue.dataset</code></strong> The Dataset of the Queueitem.</li>
<li><strong>@param {Datakey} <code>whenAddedToQueue.datakey</code></strong> The Datakey of the Queueitem.</li>
<li><strong>@param {Queueitem} <code>whenAddedToQueue.queueitem</code></strong> The Queueitem that has just been added.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_addToQueue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">operation</span><span class="p">,</span> <span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">update</span><span class="p">,</span> <span class="nx">modificationtime</span><span class="p">,</span> <span class="nx">allowFeedLock</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">inst</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">amILocked</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">allowFeedLock</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">extractInfoFromQueueitems</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span> <span class="nx">queueitems</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="p">{</span>
      <span class="nx">removed</span><span class="o">:</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span>
      <span class="nx">version</span><span class="o">:</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span>
    <span class="p">};</span>
    
    <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">queue</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">info</span><span class="p">.</span><span class="nx">version</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">o</span> <span class="o">==</span> <span class="s1">&#39;remove&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">info</span><span class="p">.</span><span class="nx">removed</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
      <span class="p">}</span>
    <span class="p">})(</span><span class="nx">queueitems</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">info</span><span class="p">;</span>
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">storeIt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="kd">var</span> <span class="nx">unlockandComplete</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span> <span class="nx">queueitem</span><span class="p">];</span>
      <span class="nx">whenAddedToQueue</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">inst</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">shift</span><span class="p">();</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="s1">&#39;added_to_queue&#39;</span><span class="p">);</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_emit</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">inst</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
    <span class="p">};</span>
    
    <span class="nx">inst</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
      <span class="nx">queueitem</span><span class="p">,</span>
      <span class="nx">unlockandComplete</span>
    <span class="p">);</span>
    
  <span class="p">};</span>
  
  <span class="kd">var</span> <span class="nx">checkAndStore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">,</span> <span class="nx">storerecord</span><span class="p">,</span> <span class="nx">existingQueueitems</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">)</span>
  <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">t</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">queueitem</span><span class="p">.</span><span class="nx">t</span> <span class="o">=</span> <span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">info</span> <span class="o">=</span> <span class="nx">extractInfoFromQueueitems</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span> <span class="nx">existingQueueitems</span><span class="p">);</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">info</span><span class="p">.</span><span class="nx">removed</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">whenAddedToQueue</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">queueitem</span><span class="p">.</span><span class="nx">b</span> <span class="o">=</span> <span class="nx">info</span><span class="p">.</span><span class="nx">version</span><span class="p">;</span>
    
    <span class="nx">storeIt</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">);</span>
    
  <span class="p">};</span>

  
  <span class="k">if</span> <span class="p">(</span><span class="nx">amILocked</span><span class="p">())</span> <span class="p">{</span>
    <span class="nx">whenAddedToQueue</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  
  <span class="kd">var</span> <span class="nx">queueitem</span> <span class="o">=</span> <span class="p">{</span><span class="nx">o</span><span class="o">:</span><span class="nx">operation</span><span class="p">,</span> <span class="nx">s</span><span class="o">:</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">k</span><span class="o">:</span><span class="nx">datakey</span><span class="p">,</span> <span class="nx">u</span><span class="o">:</span><span class="nx">update</span><span class="p">,</span> <span class="nx">t</span><span class="o">:</span><span class="nx">modificationtime</span><span class="p">,</span> <span class="nx">m</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">getModifier</span><span class="p">()};</span>

  <span class="kd">var</span> <span class="nx">validateQueueitemErr</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_basicValidationForQueueitem</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">,[</span><span class="s1">&#39;m&#39;</span><span class="p">]);</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">validateQueueitemErr</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">whenAddedToQueue</span><span class="p">(</span><span class="nx">validateQueueitemErr</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">|</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">;</span>
  
  <span class="nx">inst</span><span class="p">.</span><span class="nx">_store</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">storerecord</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">storerecord</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
      <span class="nx">err</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">whenAddedToQueue</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">inst</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">getItemsForDatasetAndDatakey</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">existingQueueitems</span><span class="p">)</span> <span class="p">{</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">);</span>
        <span class="k">return</span> <span class="nx">whenAddedToQueue</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      
      <span class="nx">checkAndStore</span><span class="p">(</span>
        <span class="nx">queueitem</span><span class="p">,</span>
        <span class="nx">storerecord</span><span class="p">,</span>
        <span class="nx">existingQueueitems</span><span class="p">,</span>
        <span class="nx">whenAddedToQueue</span>
      <span class="p">);</span>
      
    <span class="p">});</span>
  <span class="p">});</span>

  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>SyncIt._getEmptyStorerecord()</strong></p>
  </div>
  <div class="body"><p>When applying a <em>Queueitem</em> either because SyncIt is moving data from the <em>Queue</em> to the <em>Store</em> or just because it is processing a `<a href="#syncit.get--">SyncIt.get()</a> it is possible that no data already exists at the <em>Store</em> for that <em>Dataset</em> / <em>Datakey</em>. It's handy to use this function to get something that looks like stored data to limit code complexity.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">i</span><span class="o">:</span><span class="p">{},</span>
    <span class="nx">v</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
    <span class="nx">r</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
    <span class="nx">t</span><span class="o">:</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">(),</span>
    <span class="nx">m</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">_modifier</span>
  <span class="p">};</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>Will perform checks to determine whether a <em>Queueitem</em> can be applied 
based on versioning. returns {SyncIt_Constant.ErrorCode}**</p>
  </div>
  <div class="body"><p>Parameters</p>

<ul>
<li><strong>{Queueitem} <code>update</code></strong> The <em>Queueitem</em> we are testing to see if it can be applied.</li>
<li><strong>{Storerecord} <code>storeddata</code></strong> This is the data currently in the <em>Store</em> or null if there is nothing stored for that <em>Dataset</em> / <em>Datakey</em> currently.</li>
</ul>

<p>Returns</p>

<ul>
<li><strong>{err} <code>next.err</code></strong> See SyncIt_Constant.Error.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">_versionCheck</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">storeddata</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30">&#182;</a>
</div>
<p>If there is nothing in store at the location, then the version we
are applying must be to version 0;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="nx">storeddata</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">update</span><span class="p">.</span><span class="nx">b</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_APPLY_TO_FUTURE_VERSION</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
  <span class="p">}</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31">&#182;</a>
</div>
<p>If we are trying to apply something old then we must fail.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="nx">storeddata</span><span class="p">.</span><span class="nx">v</span> <span class="o">&gt;</span> <span class="nx">update</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">STALE_FOUND_IN_QUEUE</span><span class="p">;</span>
  <span class="p">}</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32">&#182;</a>
</div>
<p>Could be trying to apply something at a future version... This is silly</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
  <span class="k">if</span> <span class="p">(</span><span class="nx">storeddata</span><span class="p">.</span><span class="nx">v</span> <span class="o">&lt;</span> <span class="nx">update</span><span class="p">.</span><span class="nx">b</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_APPLY_TO_FUTURE_VERSION</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>This function adds a <em>Queueitem</em> into the <em>Store</em> if it passes some version 
checking.</p>
  </div>
  <div class="body"><p>Parameters</p>

<ul>
<li><strong>{Queueitem} <code>firstInQueue</code></strong> The <em>Queueitem</em> to apply.</li>
<li><strong>{Function} <code>next</code></strong> The function to fire when applied.
<ul><li><strong>{err} <code>next.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>{Queueitem} <code>next.firstInQueue</code></strong> This is the Queueitem that was added.</li>
<li><strong>{Storerecord} <code>next.storerecord</code></strong> This is the new data stored in the <em>Store</em> or <code>undefined</code> on failure.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_addQueueitemToStore</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">firstInQueue</span><span class="p">,</span> <span class="nx">next</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">storeItemRetrieved</span><span class="p">;</span>
    
  <span class="nx">storeItemRetrieved</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">storerecord</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">===</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">storerecord</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
      <span class="nx">e</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
    <span class="p">}</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="nx">r</span> <span class="o">=</span> <span class="nx">SyncIt</span><span class="p">.</span><span class="nx">_versionCheck</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="k">return</span> <span class="nx">next</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">);</span>
    <span class="p">}</span>
    
    <span class="kd">var</span> <span class="nx">updatedStorerecord</span> <span class="o">=</span> <span class="nx">updateResult</span><span class="p">(</span><span class="nx">storerecord</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_cloneObj</span><span class="p">);</span>
    
    <span class="k">this</span><span class="p">.</span><span class="nx">_store</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span>
      <span class="nx">firstInQueue</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span>
      <span class="nx">firstInQueue</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span>
      <span class="nx">updatedStorerecord</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">next</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">,</span> <span class="nx">updatedStorerecord</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
    
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  
  <span class="k">this</span><span class="p">.</span><span class="nx">_store</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">firstInQueue</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span> <span class="nx">storeItemRetrieved</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.apply()">
  <h3>
    <a href="#syncit.apply()" name="syncit.apply()" class="pilcrow">&#182;</a>
    SyncIt.apply()
  </h3>
</div>

  </div>
  <div class="body"><p>Applies the very first <em>Queueitem</em> in the <em>Queue</em> onto the data already in the <em>Store</em> for that <em>Dataset</em> / <em>Datakey</em>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>done</code></strong> Callback when the operation is complete (or not). Signature: <code>function(errorCode, queueitem, storerecord)</code>
<ul><li><strong>@param {ErrorCode} <code>done.errorCode</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Queueitem} <code>done.queueitem</code></strong> The <em>Queueitem</em> we are trying to apply. <code>Null</code> only if queue is empty.</li>
<li><strong>@param {Storerecord} <code>done.storerecord</code></strong> The new <em>Storerecord</em> that is now in the Store, <code>undefined</code> on everything but success.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">apply</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">whenAddedToQueue</span><span class="p">,</span>
    <span class="nx">inst</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  
  <span class="nx">whenAddedToQueue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">,</span> <span class="nx">newStorerecord</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nx">inst</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">advance</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">COULD_NOT_ADVANCE_QUEUE</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span><span class="s1">&#39;applied&#39;</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">,</span> <span class="nx">newStorerecord</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span> <span class="nx">firstInQueue</span><span class="p">,</span> <span class="nx">newStorerecord</span><span class="p">);</span>
    <span class="p">});</span>

  <span class="p">};</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  
  <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">|</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">;</span>
  
  <span class="nx">inst</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">getFirst</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">firstItem</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">e</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">QUEUE_EMPTY</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">e</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_addQueueitemToStore</span><span class="p">(</span><span class="nx">firstItem</span><span class="p">,</span> <span class="nx">whenAddedToQueue</span><span class="p">);</span>
  <span class="p">});</span>
  
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.get()">
  <h3>
    <a href="#syncit.get()" name="syncit.get()" class="pilcrow">&#182;</a>
    SyncIt.get()
  </h3>
</div>

  </div>
  <div class="body"><p>Will retrieve information from SyncIt by reading what is first in the <em>Store</em> and then applying <em>Queueitem</em> from the <em>Queue</em> on top of it.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenDataRetrieved</code></strong> Signature: <code>function(err, jreadInfo)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDataRetrieved.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Object} <code>whenDataRetrieved.jreadInfo</code></strong> The requsted information.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">get</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenDataRetrieved</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">getFull</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">.</span><span class="nx">i</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
  </div>
  <div class="body">
<div class="pilwrap" id="syncit.getfull()">
  <h3>
    <a href="#syncit.getfull()" name="syncit.getfull()" class="pilcrow">&#182;</a>
    SyncIt.getFull()
  </h3>
</div>


<p>Will get ALL information for a <em>Dataset</em> / <em>Datakey</em> from SyncIt including metadata.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>dataset</code></strong></li>
<li><strong>@param {Datakey} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>whenDataRetrieved</code></strong> Signature: Function(err, jreadh)
<ul><li><strong>@param {ErrorCode} <code>whenDataRetrieved.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Jread} <code>whenDataRetrieved.jread</code></strong> The requsted information.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFull</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="nx">whenDataRetrieved</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">inst</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  
  <span class="nx">inst</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">getItemsForDatasetAndDatakey</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
    
    <span class="nx">inst</span><span class="p">.</span><span class="nx">_store</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">datakey</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">len</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
        <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">e</span> <span class="o">===</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span> <span class="o">=</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_getEmptyStorerecord</span><span class="p">();</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">len</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">e</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">b</span> <span class="o">==</span> <span class="nx">r</span><span class="p">.</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">r</span> <span class="o">=</span> <span class="nx">updateResult</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span> <span class="nx">queue</span><span class="p">[</span><span class="nx">i</span><span class="p">],</span> <span class="nx">inst</span><span class="p">.</span><span class="nx">_cloneObj</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>

      <span class="nx">r</span><span class="p">.</span><span class="nx">s</span> <span class="o">=</span> <span class="nx">dataset</span><span class="p">;</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">k</span> <span class="o">=</span> <span class="nx">datakey</span><span class="p">;</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">v</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">whenDataRetrieved</span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">r</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">});</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p>_mergeArraysWhenCountIs()</p>
  </div>
  <div class="body"><p>Will merge and return all the sub array in <code>arrayOfArrays</code> if <code>targetResolved == isResolved</code>, otherwise it will return false.</p>

<p>This is only here because it's shared between <code>getDatasetNames.getDatasetNames()</code> and <code>SyncIt.getDatakeysInDataset()</code>. It does not form part of the API</p>

<p>Parameters</p>

<ul>
<li><strong>@param {Number} <code>targetResolved</code></strong> See result.</li>
<li><strong>@param {Number} <code>isResolved</code></strong> See result.</li>
<li><strong>@param {Array} <code>arrayOfArrays</code></strong> An array of sub arrays.</li>
</ul>

<p>Returns</p>

<ul>
<li><strong>@return {False|Array}</strong> False if <code>targetResolved</code> != <code>isResolved</code>, Array otherwise.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">_mergeArraysWhenCountIs</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">targetResolved</span><span class="p">,</span> <span class="nx">isResolved</span><span class="p">,</span> <span class="nx">arrayOfArrays</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">targetResolved</span> <span class="o">!=</span> <span class="nx">isResolved</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">vals</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ar</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">while</span> <span class="p">(</span><span class="nx">ar</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">toAdd</span> <span class="o">=</span> <span class="nx">ar</span><span class="p">.</span><span class="nx">pop</span><span class="p">();</span>
      <span class="nx">toAdd</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
      <span class="nx">toAdd</span><span class="p">.</span><span class="nx">unshift</span><span class="p">(</span><span class="nx">ar</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">length</span><span class="p">);</span>
      <span class="nx">ar</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">splice</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">ar</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nx">toAdd</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">ar</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="p">})(</span><span class="nx">arrayOfArrays</span><span class="p">);</span>
  
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nx">l</span><span class="o">=</span><span class="nx">vals</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">vals</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">vals</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getdatasetnames()">
  <h3>
    <a href="#syncit.getdatasetnames()" name="syncit.getdatasetnames()" class="pilcrow">&#182;</a>
    SyncIt.getDatasetNames()
  </h3>
</div>

  </div>
  <div class="body"><p>Lists all dataset names in the <em>Store</em>, <em>Queue</em> or both.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Number} <code>inWhere</code></strong> Selects if you want <em>Dataset</em> names in the <em>Queue</em>, <em>Store</em> or both, Sum your desired SyncIt_Constant.Location.IN_QUEUE + SyncIt_Constant.Location.IN_STORE</li>
<li><strong>@param {Function} <code>whenDatasetsKnown</code></strong> Signature: <code>function(err, arrayOfNames)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDatasetsKnown.err</code></strong> See <code>SyncIt_Constant.Error</code>.</li>
<li><strong>@param {Array} <code>whenDatasetsKnown.arrayOfNames</code></strong> An array of <em>dataset</em> names</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDatasetNames</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">inWhere</span><span class="p">,</span> <span class="nx">whenDatasetsKnown</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">rs</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">resolved</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">tmpR</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">possiblySend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">tmpR</span> <span class="o">=</span> <span class="nx">_mergeArraysWhenCountIs</span><span class="p">(</span><span class="nx">inWhere</span><span class="p">,</span> <span class="nx">resolved</span><span class="p">,</span> <span class="nx">rs</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">tmpR</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">whenDatasetsKnown</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span> <span class="nx">tmpR</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">&amp;</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Location</span><span class="p">.</span><span class="nx">IN_STORE</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_store</span><span class="p">.</span><span class="nx">getDatasetNames</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">whenDatasetsKnown</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">resolved</span> <span class="o">=</span> <span class="nx">resolved</span> <span class="o">+</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Location</span><span class="p">.</span><span class="nx">IN_STORE</span><span class="p">;</span>
      <span class="nx">rs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">names</span><span class="p">);</span>
      <span class="nx">possiblySend</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">&amp;</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Location</span><span class="p">.</span><span class="nx">IN_QUEUE</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">getDatasetNames</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">datasetNames</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">whenDatasetsKnown</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">resolved</span> <span class="o">=</span> <span class="nx">resolved</span> <span class="o">+</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Location</span><span class="p">.</span><span class="nx">IN_QUEUE</span><span class="p">;</span>
      <span class="nx">rs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">datasetNames</span><span class="p">);</span>
      <span class="nx">possiblySend</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.getdatakeysindataset()">
  <h3>
    <a href="#syncit.getdatakeysindataset()" name="syncit.getdatakeysindataset()" class="pilcrow">&#182;</a>
    SyncIt.getDatakeysInDataset()
  </h3>
</div>

  </div>
  <div class="body"><p>Lists Datakeys in a Dataset.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Dataset} <code>datasetName</code></strong></li>
<li><strong>@param {Number} <code>inWhere</code></strong> Selects if you want <em>Datakey</em> names in the Queue, Store or both. Sum your desired SyncIt_Constant.Location.IN_QUEUE + SyncIt_Constant.Location.IN_STORE</li>
<li><strong>@param {Function} <code>whenDatakeysKnown</code></strong> Signature: <code>function(err, arrayOfNames)</code>
<ul><li><strong>@param {ErrorCode} <code>whenDatakeysKnown.err</code></strong> See SyncIt_Constant.Error.</li>
<li><strong>@param {Array} <code>whenDatakeysKnown.arrayOfNames</code></strong> An array of <em>Datakey</em> names</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDatakeysInDataset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">datasetName</span><span class="p">,</span> <span class="nx">inWhere</span><span class="p">,</span> <span class="nx">whenDatakeysKnown</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">rs</span> <span class="o">=</span> <span class="p">[],</span>
    <span class="nx">resolved</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">tmpR</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">possiblySend</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">tmpR</span> <span class="o">=</span> <span class="nx">_mergeArraysWhenCountIs</span><span class="p">(</span><span class="nx">inWhere</span><span class="p">,</span> <span class="nx">resolved</span><span class="p">,</span> <span class="nx">rs</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">tmpR</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">whenDatakeysKnown</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span> <span class="nx">tmpR</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">&amp;</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Location</span><span class="p">.</span><span class="nx">IN_STORE</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_store</span><span class="p">.</span><span class="nx">getDatakeyNames</span><span class="p">(</span><span class="nx">datasetName</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">whenDatakeysKnown</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">resolved</span> <span class="o">=</span> <span class="nx">resolved</span> <span class="o">+</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Location</span><span class="p">.</span><span class="nx">IN_STORE</span><span class="p">;</span>
      <span class="nx">rs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">names</span><span class="p">);</span>
      <span class="nx">possiblySend</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">inWhere</span> <span class="o">&amp;</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Location</span><span class="p">.</span><span class="nx">IN_QUEUE</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">getDatakeyInDataset</span><span class="p">(</span><span class="nx">datasetName</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">datakeys</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">whenDatakeysKnown</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="nx">resolved</span> <span class="o">=</span> <span class="nx">resolved</span> <span class="o">+</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Location</span><span class="p">.</span><span class="nx">IN_QUEUE</span><span class="p">;</span>
      <span class="nx">rs</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">datakeys</span><span class="p">);</span>
      <span class="nx">possiblySend</span><span class="p">();</span>
    <span class="p">});</span>
  <span class="p">}</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit.removestalefromqueue()">
  <h3>
    <a href="#syncit.removestalefromqueue()" name="syncit.removestalefromqueue()" class="pilcrow">&#182;</a>
    SyncIt.removeStaleFromQueue()
  </h3>
</div>

  </div>
  <div class="body"><p>If somehow a Queueitem is applied to the store, but could not be removed then
this function should be used to remove them from the Queue at a later date.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>whenDatakeysKnown</code></strong> Signature: <code>function(err)</code></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeStaleFromQueue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">|</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">working</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  
    <span class="kd">var</span> <span class="nx">unlock</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_locked</span> <span class="o">&amp;</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">MAXIMUM_BIT_PATTERN</span> <span class="o">^</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Locking</span><span class="p">.</span><span class="nx">PROCESSING</span><span class="p">);</span>
      <span class="nx">done</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
  
    <span class="k">this</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">getFirst</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">)</span> <span class="p">{</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlock</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">unlock</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
      <span class="p">}</span>
  
      <span class="k">this</span><span class="p">.</span><span class="nx">_store</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">storerecord</span><span class="p">)</span> <span class="p">{</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlock</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">b</span> <span class="o">&gt;=</span> <span class="nx">storerecord</span><span class="p">.</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">unlock</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">);</span>
        <span class="p">}</span>
  
        <span class="k">this</span><span class="p">.</span><span class="nx">_queue</span><span class="p">.</span><span class="nx">advance</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">unlock</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span>
          <span class="p">}</span>
          <span class="k">return</span> <span class="nx">working</span><span class="p">(</span><span class="nx">done</span><span class="p">);</span>
        <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  
      <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
  
    <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>

  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>

  <span class="nx">working</span><span class="p">();</span>
<span class="p">};</span>

<span class="k">return</span> <span class="nx">SyncIt</span><span class="p">;</span>

<span class="p">});</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
