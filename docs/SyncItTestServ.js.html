<!DOCTYPE html>
<html>
<head>
  <title>SyncItTestServ.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="doc-style.css" />
  <script src="doc-filelist.js"></script>
  <script>
    var relativeDir = "", thisFile = "home/fozz/Projects/syncit//SyncItTestServ.js", defaultSidebar = true;
  </script>
  <script src="doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h3">
        <a href="#new%20testserver()">new TestServer()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#testserver.getdatasetnames()">TestServer.getDatasetNames()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#testserver.getqueueitem()">TestServer.getQueueitem()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#testserver.getvalue()">TestServer.getValue()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#testserver.listenforfed()">TestServer.listenForFed()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#testserver.listen()">TestServer.listen()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#testserver._setremoveorupdate()">TestServer._setRemoveOrUpdate()</a>
      </div>
      <div class="heading h3">
        <a href="#testserver.put()">TestServer.PUT()</a>
      </div>
      <div class="heading h3">
        <a href="#testserver.patch()">TestServer.PATCH()</a>
      </div>
      <div class="heading h3">
        <a href="#testserver.delete()">TestServer.DELETE()</a>
      </div>
      <div class="heading h3">
        <a href="#testserver._getmodifier()">TestServer._getModifier()</a>
      </div>
      <div class="heading h3">
        <a href="#testserver._getqueueitemfromrequestbody()">TestServer._getQueueitemFromRequestBody()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#validateinputfieldagainstregex">validateInputFieldAgainstRegex</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>SyncItTestServ.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="cm">/*jshint smarttabs:true */</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">factory</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// UMD from https://github.com/umdjs/umd/blob/master/returnExports.js</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span>
      <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./SyncIt.js&#39;</span><span class="p">),</span>
      <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;./Constant.js&#39;</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">define</span><span class="p">(</span>
      <span class="p">[</span><span class="s1">&#39;syncit/SyncIt&#39;</span><span class="p">,</span><span class="s1">&#39;syncit/Constant&#39;</span><span class="p">],</span>
      <span class="nx">factory</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">SyncItTestServ</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span>
      <span class="nx">root</span><span class="p">.</span><span class="nx">SyncIt</span><span class="p">,</span>
      <span class="nx">root</span><span class="p">.</span><span class="nx">SyncIt_Constant</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">})(</span><span class="k">this</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">SyncItLib</span><span class="p">,</span><span class="nx">SyncIt_Constant</span><span class="p">)</span> <span class="p">{</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: 2013 Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>

<span class="s2">&quot;use strict&quot;</span><span class="p">;</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="new%20testserver()">
  <h3>
    <a href="#new%20testserver()" name="new%20testserver()" class="pilcrow">&#182;</a>
    new TestServer()
  </h3>
</div>

  </div>
  <div class="body"><p>Constructor</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {ServerPersist} <code>serverPersist</code></strong> A <a href="ServerPersist/MemoryAsync.js.html">ServerPersist</a> instance.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">TestServer</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">serverPersist</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_serverPersist</span> <span class="o">=</span> <span class="nx">serverPersist</span><span class="p">;</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span> <span class="o">=</span> <span class="p">{</span><span class="nx">fed</span><span class="o">:</span> <span class="p">[]};</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver.getdatasetnames()">
  <h3>
    <a href="#testserver.getdatasetnames()" name="testserver.getdatasetnames()" class="pilcrow">&#182;</a>
    TestServer.getDatasetNames()
  </h3>
</div>

  </div>
  <div class="body"><p>Retrieves a list of <em>Dataset</em> names.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Request} <code>req</code></strong> A Express like Request Object</li>
<li><strong>@param {Function} <code>responder</code></strong> Callback. Signature: <code>function (statusString, data)</code>
<ul><li><strong>@param {String} <code>responder.statusString</code></strong> Always 'ok'</li>
<li><strong>@param {Array} <code>responder.data</code></strong> An Array of <em>Dataset</em> names</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDatasetNames</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_serverPersist</span><span class="p">.</span><span class="nx">getDatasetNames</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">names</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span><span class="nx">names</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver.getqueueitem()">
  <h3>
    <a href="#testserver.getqueueitem()" name="testserver.getqueueitem()" class="pilcrow">&#182;</a>
    TestServer.getQueueitem()
  </h3>
</div>

  </div>
  <div class="body"><p>Retrieves a list of Queueitem from a previously known one.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Request} <code>req</code></strong> A Express like Request Object
<ul><li><strong>@param {String} <code>req.params.dataset</code></strong> REQUIRED: The <em>Dataset</em> you want to download updates from</li>
<li><strong>@param {String} <code>req.params.from</code></strong> OPTIONAL: The last known Id for a Queueitem, if supplied all items from that Queuitem, but not including it will be downloaded.</li></ul></li>
<li><strong>@param {Function} <code>responder</code></strong> Callback. Signature: <code>function (statusString, data)</code>
<ul><li><strong>@param {String} <code>responder.statusString</code></strong> 'validation_error' if no dataset supplied, 'ok' otherwise.</li>
<li><strong>@param {Object} <code>responder.data</code></strong> An object in the form <code>{queueitems: [&lt;Queueitem&gt;,&lt;Queu...&gt;], to: &lt;QueueitemId&gt;}</code></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getQueueitem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">filter</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validate_params_dataset</span><span class="p">(</span><span class="nx">req</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;validation_error&#39;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_serverPersist</span><span class="p">.</span><span class="nx">getQueueitem</span><span class="p">(</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;from&#39;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">req</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">from</span> <span class="o">:</span> <span class="kc">null</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">queueitems</span><span class="p">,</span><span class="nx">to</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span> <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span> <span class="p">}</span>
      <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;ok&#39;</span><span class="p">,{</span> <span class="nx">queueitems</span><span class="o">:</span><span class="nx">queueitems</span><span class="p">,</span> <span class="nx">to</span><span class="o">:</span> <span class="nx">to</span><span class="p">});</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver.getvalue()">
  <h3>
    <a href="#testserver.getvalue()" name="testserver.getvalue()" class="pilcrow">&#182;</a>
    TestServer.getValue()
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Request} <code>req</code></strong> A Express like Request Object</li>
<li><strong>@param {Function} <code>responder</code></strong> Callback. Signature: <code>function (statusString, data)</code>
<ul><li><strong>@param {String} <code>responder.statusString</code></strong> <code>validation_error</code> if not given a valid looking Dataset and Datakey. <code>not_found</code> If the Dataset and Datakey has no records. <code>gone</code> If there was data, but it has been deleted. <code>ok</code> should data be found.</li>
<li><strong>@param {Object} <code>responder.data</code></strong> The Jrec stored at that location.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validate_params_dataset</span><span class="p">(</span><span class="nx">req</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;validation_error&#39;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validate_params_datakey</span><span class="p">(</span><span class="nx">req</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;validation_error&#39;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_serverPersist</span><span class="p">.</span><span class="nx">getValue</span><span class="p">(</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span>
    <span class="nx">req</span><span class="p">.</span><span class="nx">params</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">jrec</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;not_found&#39;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">jrec</span><span class="p">.</span><span class="nx">r</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;gone&#39;</span><span class="p">,</span><span class="nx">jrec</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;ok&#39;</span><span class="p">,</span><span class="nx">jrec</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver.listenforfed()">
  <h3>
    <a href="#testserver.listenforfed()" name="testserver.listenforfed()" class="pilcrow">&#182;</a>
    TestServer.listenForFed()
  </h3>
</div>

  </div>
  <div class="body"><p>Listen for data changes.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>listener</code></strong> Callback. Signature: <code>function (processedQueueitem, processedJrec)</code>
<ul><li><strong>@param {String} <code>listener.dataset</code></strong> The dataset of the just fed Queueitem.</li>
<li><strong>@param {String} <code>listener.datakey</code></strong> The datakey of the just fed Queueitem.</li>
<li><strong>@param {Queueitem} <code>listener.processedQueueitem</code></strong> The Queueitem which has just been added</li>
<li><strong>@param {Storerecord} <code>listener.processedJrec</code></strong> The resulting data after the Queueitem has been applied</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listenForFed</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="s1">&#39;fed&#39;</span><span class="p">,</span><span class="nx">listener</span><span class="p">);</span>
<span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver.listen()">
  <h3>
    <a href="#testserver.listen()" name="testserver.listen()" class="pilcrow">&#182;</a>
    TestServer.listen()
  </h3>
</div>

  </div>
  <div class="body"><p>See <a href="#testserver.listenforfed--">TestServer.listenForFed()</a>, as that is the only supported event.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>event</code></strong> The event to listen to</li>
<li><strong>@param {Function} <code>listener</code></strong> The function which will be fired when the event occurs</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">listen</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">,</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">propertyNames</span> <span class="o">=</span> <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">ob</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">k</span> <span class="k">in</span> <span class="nx">ob</span><span class="p">)</span> <span class="p">{</span> <span class="k">if</span> <span class="p">(</span><span class="nx">ob</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">k</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">k</span><span class="p">);</span>
    <span class="p">}</span> <span class="p">}</span>
    <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
  <span class="p">})(</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">propertyNames</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">push</span><span class="p">(</span><span class="nx">listener</span><span class="p">);</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>Translations from SyncIt_Constant.Error to StatusString.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">feedErrors</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">lockedError</span><span class="o">:</span><span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">UNABLE_TO_PROCESS_BECAUSE_LOCKED</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;service_unavailable&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">versionError</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_ADD_FUTURE_QUEUEITEM</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;conflict&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">unexpectedError</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">!==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="s2">&quot;TestServer.unexpectedError: Unexpected error code &quot;</span><span class="o">+</span><span class="nx">err</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">tryingToApplyOld</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_ADD_QUEUEITEM_BASED_ON_OLD_VERSION</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;out_of_date&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">},</span>
  <span class="nx">modifyRemoved</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">==</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="s1">&#39;gone&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver._setremoveorupdate()">
  <h3>
    <a href="#testserver._setremoveorupdate()" name="testserver._setremoveorupdate()" class="pilcrow">&#182;</a>
    TestServer._setRemoveOrUpdate()
  </h3>
</div>

  </div>
  <div class="body"><p>TestServer.PATCH(), TestServer.PUT() and TestServer.DELETE() really all do 
the same thing, that being to put a Queueitem on the Queue and then calculate
the result of that operation. Therefore all the functions wrap this general
purpose function.</p>

<ul>
<li><strong>@param {Request} <code>req</code></strong> A Express like Request Object
<ul><li><strong>@param {Object} <code>req.body</code></strong> Should look like a Queueitem. See <a href="#testserver._getqueueitemfromrequestbody--">TestServer._getQueueitemFromRequestBody()</a></li></ul></li>
<li><strong>@param {Function} <code>responder</code></strong> Callback. Signature: <code>function (statusString, data)</code>
<ul><li><strong>@param {String} <code>responder.statusString</code></strong> Quite a set... <code>validation_error</code> || <code>service_unavailable</code> || <code>conflict</code> || <code>out_of_date</code> || <code>gone</code> || <code>created</code> || <code>ok</code></li>
<li><strong>@param {Object} <code>responder.data</code></strong> Object {loc: <location>, to: <lastId>}
<ul><li><strong>@param {String} <code>responder.data.loc</code></strong> The Dataset and Datakey seperated by a '/'</li>
<li><strong>@param {String} <code>responder.data.to</code></strong> The Id which which was just created, this is for use in <a href="#testserver.getqueueitem--">TestServer.getQueueitem()</a></li></ul></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_setRemoveOrUpdate</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">operation</span><span class="p">,</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">datakey</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">,</span>
    <span class="nx">dataset</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validate_queueitem</span><span class="p">(</span><span class="nx">req</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;validation_error&#39;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">queueitem</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getQueueitemFromRequestBody</span><span class="p">(</span><span class="nx">req</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">o</span> <span class="o">!==</span> <span class="nx">operation</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;validation_error&#39;</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;validation_error&#39;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="k">if</span> <span class="p">((</span><span class="nx">operation</span> <span class="o">!=</span> <span class="s1">&#39;remove&#39;</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="s1">&#39;validation_error&#39;</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
  <span class="p">}</span>
  
  <span class="kd">var</span> <span class="nx">inst</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="nx">inst</span><span class="p">.</span><span class="nx">_serverPersist</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span>
    <span class="nx">queueitem</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">err</span><span class="p">,</span><span class="nx">processedQueueitem</span><span class="p">,</span><span class="nx">processedJrec</span><span class="p">,</span><span class="nx">createdId</span><span class="p">)</span> <span class="p">{</span>
      
      <span class="kd">var</span> <span class="nx">emit</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">emit</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">===</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_ADD_ALREADY_ADDED_QUEUEITEM</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">err</span> <span class="o">=</span> <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="kd">var</span> <span class="nx">checks</span> <span class="o">=</span> <span class="p">[</span>
        <span class="nx">feedErrors</span><span class="p">.</span><span class="nx">lockedError</span><span class="p">,</span>
        <span class="nx">feedErrors</span><span class="p">.</span><span class="nx">versionError</span><span class="p">,</span>
        <span class="nx">feedErrors</span><span class="p">.</span><span class="nx">tryingToApplyOld</span><span class="p">,</span>
        <span class="nx">feedErrors</span><span class="p">.</span><span class="nx">modifyRemoved</span><span class="p">,</span>
        <span class="nx">feedErrors</span><span class="p">.</span><span class="nx">unexpectedError</span>
      <span class="p">];</span>
      
      <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
      
      <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">checks</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">r</span> <span class="o">=</span> <span class="nx">checks</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">err</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">r</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span><span class="nx">r</span><span class="p">,</span><span class="kc">null</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">}</span>
      
      <span class="k">if</span> <span class="p">(</span><span class="nx">emit</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">inst</span><span class="p">.</span><span class="nx">_emit</span><span class="p">(</span>
          <span class="s1">&#39;fed&#39;</span><span class="p">,</span>
          <span class="nx">processedQueueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span>
          <span class="nx">processedQueueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span>
          <span class="nx">processedQueueitem</span><span class="p">,</span>
          <span class="nx">processedJrec</span>
        <span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">responder</span><span class="p">(</span>
        <span class="nx">queueitem</span><span class="p">.</span><span class="nx">b</span> <span class="o">===</span> <span class="mi">0</span> <span class="o">?</span> <span class="s1">&#39;created&#39;</span> <span class="o">:</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span>
        <span class="p">{</span>
          <span class="nx">loc</span><span class="o">:</span> <span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">processedQueueitem</span><span class="p">.</span><span class="nx">s</span><span class="o">+</span><span class="s1">&#39;/&#39;</span><span class="o">+</span><span class="nx">processedQueueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span>
          <span class="nx">to</span><span class="o">:</span> <span class="nx">createdId</span>
        <span class="p">}</span>
      <span class="p">);</span>
    <span class="p">},</span>
    <span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&quot;SERVER_APPLIED&quot;</span><span class="p">);</span> <span class="p">}</span>
  <span class="p">);</span>

<span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver.put()">
  <h3>
    <a href="#testserver.put()" name="testserver.put()" class="pilcrow">&#182;</a>
    TestServer.PUT()
  </h3>
</div>

  </div>
  <div class="body"><p>The operation (o) in the Request (<code>req.body</code>) object should be 'set'. For all other documentation see <a href="#testserver._setremoveorupdate--">TestServer.(_setRemoveOrUpdate)</a>.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">PUT</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_setRemoveOrUpdate</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="s1">&#39;set&#39;</span><span class="p">,</span><span class="nx">responder</span><span class="p">);</span>
<span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver.patch()">
  <h3>
    <a href="#testserver.patch()" name="testserver.patch()" class="pilcrow">&#182;</a>
    TestServer.PATCH()
  </h3>
</div>

  </div>
  <div class="body"><p>The operation (o) in the Request (<code>req.body</code>) object should be 'update'. For all other documentation see <a href="#testserver._setremoveorupdate--">TestServer.(_setRemoveOrUpdate)</a>.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">PATCH</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_setRemoveOrUpdate</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="s1">&#39;update&#39;</span><span class="p">,</span><span class="nx">responder</span><span class="p">);</span>
<span class="p">};</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver.delete()">
  <h3>
    <a href="#testserver.delete()" name="testserver.delete()" class="pilcrow">&#182;</a>
    TestServer.DELETE()
  </h3>
</div>

  </div>
  <div class="body"><p>The operation (o) in the Request (<code>req.body</code>) object should be 'remove'. For all other documentation see <a href="#testserver._setremoveorupdate--">TestServer.(_setRemoveOrUpdate)</a>.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">DELETE</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="nx">responder</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_setRemoveOrUpdate</span><span class="p">(</span><span class="nx">req</span><span class="p">,</span><span class="s1">&#39;remove&#39;</span><span class="p">,</span><span class="nx">responder</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver._getmodifier()">
  <h3>
    <a href="#testserver._getmodifier()" name="testserver._getmodifier()" class="pilcrow">&#182;</a>
    TestServer._getModifier()
  </h3>
</div>

  </div>
  <div class="body"><p>Gets the Modifier (m) of the client uploading the data.</p>

<p>If the TestServer was running on a <strong>real</strong> server, it would probably be doing something sensible, instead of just taking the <code>m</code> property from the <code>body</code> or the <code>req</code> object.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getModifier</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">m</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>TestServer._emit()</strong></p>
  </div>
  <div class="body"><p>Emits an Event.</p>

<p><strong>Parameters</strong></p>

<ul>
<li><strong>@param {String} <code>event</code></strong> The name of the Event you wish to emit.</li>
<li><strong>@param {} <code>param2, param3, ...</code></strong> Extra parameters will be passed to the event listener.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_emit</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">,</span><span class="mi">1</span><span class="p">);</span>
  
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">event</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">throw</span> <span class="s2">&quot;SyncIt._emit(): Firing not know event &#39;&quot;</span><span class="o">+</span><span class="nx">event</span><span class="o">+</span><span class="s2">&quot;&#39;&quot;</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">].</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_listeners</span><span class="p">[</span><span class="nx">event</span><span class="p">][</span><span class="nx">i</span><span class="p">].</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">args</span><span class="p">);</span>
  <span class="p">}</span>
  
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">queueitemProperties</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">];</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testserver._getqueueitemfromrequestbody()">
  <h3>
    <a href="#testserver._getqueueitemfromrequestbody()" name="testserver._getqueueitemfromrequestbody()" class="pilcrow">&#182;</a>
    TestServer._getQueueitemFromRequestBody()
  </h3>
</div>

  </div>
  <div class="body"><p>Converts a Express <code>req.body</code> into a Queueitem.</p>

<p>Expects to see something like the following:</p>

<div class='highlight'><pre><code language=''>{
    s: &lt;Dataset&gt;,
    k: &lt;Datakey&gt;,
    b: &lt;Basedonversion&gt;,
    m: &lt;Modifier&gt;, // (Note: This should not be here, or at least should be overridden by the Session or something that the User cannot control)
    t: &lt;Modificationtime&gt;,
    o: &lt;Operation&gt;,
    u: &lt;Update&gt;,
}
</code></pre></div>

<p>See <a href="SyncIt.js.html">SyncIt documentation</a> for details about what a Queueitem is etc.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Request} <code>req</code></strong> A Express like Request Object.
<ul><li><strong>@param {Object} <code>req.body</code></strong> See description.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getQueueitemFromRequestBody</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">request</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">{},</span>
    <span class="nx">requestBody</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">queueitemProperties</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">requestBody</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">queueitemProperties</span><span class="p">[</span><span class="nx">i</span><span class="p">])){</span>
      <span class="nx">r</span><span class="p">[</span><span class="nx">queueitemProperties</span><span class="p">[</span><span class="nx">i</span><span class="p">]]</span> <span class="o">=</span>
        <span class="nx">requestBody</span><span class="p">[</span><span class="nx">queueitemProperties</span><span class="p">[</span><span class="nx">i</span><span class="p">]];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="nx">r</span><span class="p">.</span><span class="nx">m</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getModifier</span><span class="p">(</span><span class="nx">request</span><span class="p">);</span>
  <span class="k">return</span> <span class="nx">r</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="validateinputfieldagainstregex">
  <h3>
    <a href="#validateinputfieldagainstregex" name="validateinputfieldagainstregex" class="pilcrow">&#182;</a>
    validateInputFieldAgainstRegex
  </h3>
</div>

  </div>
  <div class="body"><p>Validates a Request (<code>req</code>) <code>field</code> within either the <code>req.body</code> or <code>req.params</code> against a <code>regexp</code>.</p>


<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>field</code></strong> The field you are checking.</li>
<li><strong>@param {Regexp} <code>regexp</code></strong> The RegExp you are checking the field against.</li>
<li><strong>@param {Boolean} <code>fromBody</code></strong> If this is <code>true</code> the field will be found in the Request Body (<code>req.body</code>), otherwise the Request Params (<code>req.params</code>)</li>
<li><strong>@param {Request} <code>req</code></strong> The Request ot look in to find the data.</li>
<li><strong>@return {Boolean}</strong> <code>true</code> if the input is OK.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">validateInputFieldAgainstRegexp</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">field</span><span class="p">,</span><span class="nx">regexp</span><span class="p">,</span><span class="nx">fromBody</span><span class="p">,</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">regexp</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">fromBody</span> <span class="o">?</span> <span class="s1">&#39;body&#39;</span> <span class="o">:</span> <span class="s1">&#39;params&#39;</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">[</span><span class="nx">fromBody</span> <span class="o">?</span> <span class="s1">&#39;body&#39;</span> <span class="o">:</span> <span class="s1">&#39;params&#39;</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">field</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="nx">req</span><span class="p">[</span><span class="nx">fromBody</span> <span class="o">?</span> <span class="s1">&#39;body&#39;</span> <span class="o">:</span> <span class="s1">&#39;params&#39;</span><span class="p">][</span><span class="nx">field</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="nx">regexp</span><span class="p">)</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
<span class="p">};</span>

<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_validate_params_dataset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">validateInputFieldAgainstRegexp</span><span class="p">(</span>
    <span class="s1">&#39;s&#39;</span><span class="p">,</span>
    <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">DATASET_REGEXP</span><span class="p">,</span>
    <span class="kc">false</span><span class="p">,</span>
    <span class="nx">req</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_validate_params_datakey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">validateInputFieldAgainstRegexp</span><span class="p">(</span>
    <span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">DATASET_REGEXP</span><span class="p">,</span>
    <span class="kc">false</span><span class="p">,</span>
    <span class="nx">req</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_validate_body_queueitem_dataset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">validateInputFieldAgainstRegexp</span><span class="p">(</span>
    <span class="s1">&#39;s&#39;</span><span class="p">,</span>
    <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">DATASET_REGEXP</span><span class="p">,</span>
    <span class="kc">true</span><span class="p">,</span>
    <span class="nx">req</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_validate_body_queueitem_datakey</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">validateInputFieldAgainstRegexp</span><span class="p">(</span>
    <span class="s1">&#39;k&#39;</span><span class="p">,</span>
    <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">DATAKEY_REGEXP</span><span class="p">,</span>
    <span class="kc">true</span><span class="p">,</span>
    <span class="nx">req</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_validate_body_queueitem_modifier</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">validateInputFieldAgainstRegexp</span><span class="p">(</span>
    <span class="s1">&#39;m&#39;</span><span class="p">,</span>
    <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">MODIFIER_REGEXP</span><span class="p">,</span>
    <span class="kc">true</span><span class="p">,</span>
    <span class="nx">req</span>
  <span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">m</span> <span class="o">===</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getModifier</span><span class="p">(</span><span class="nx">req</span><span class="p">));</span>
<span class="p">};</span>

<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_validate_body_queueitem_operation</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">validateInputFieldAgainstRegexp</span><span class="p">(</span>
    <span class="s1">&#39;o&#39;</span><span class="p">,</span>
    <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nx">Validation</span><span class="p">.</span><span class="nx">OPERATION_REGEXP</span><span class="p">,</span>
    <span class="kc">true</span><span class="p">,</span>
    <span class="nx">req</span>
  <span class="p">);</span>
<span class="p">};</span>

<span class="nx">TestServer</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_validate_queueitem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">req</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validate_body_queueitem_dataset</span><span class="p">(</span><span class="nx">req</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validate_body_queueitem_datakey</span><span class="p">(</span><span class="nx">req</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validate_body_queueitem_modifier</span><span class="p">(</span><span class="nx">req</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">_validate_body_queueitem_operation</span><span class="p">(</span><span class="nx">req</span><span class="p">))</span> <span class="p">{</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span> <span class="p">}</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">queueitemProperties</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">queueitemProperties</span><span class="p">[</span><span class="nx">i</span><span class="p">]))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>

<span class="k">return</span> <span class="nx">TestServer</span><span class="p">;</span>
<span class="p">});</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
