<!DOCTYPE html>
<html>
<head>
  <title>MemoryAsync.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = "../", thisFile = "home/fozz/Projects/syncit//ServerPersist/MemoryAsync.js", defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h2">
        <a href="#syncit_serverpersist_memoryasync">SyncIt_ServerPersist_MemoryAsync</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit_serverpersist_memoryasync.getqueueitem()">SyncIt_ServerPersist_MemoryAsync.getQueueitem()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit_serverpersist_memoryasync.getvalue()">SyncIt_ServerPersist_MemoryAsync.getValue()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
      <div class="heading h3">
        <a href="#syncit_serverpersist_memoryasync.push()">SyncIt_ServerPersist_MemoryAsync.push()</a>
      </div>
      <div class="heading h4">
        <a href="#parameters">Parameters</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs">
          <h1>MemoryAsync.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1">&#182;</a>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="cm">/*jshint smarttabs:true */</span>
<span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">factory</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// UMD from https://github.com/umdjs/umd/blob/master/returnExports.js</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">===</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span>
      <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../Constant.js&#39;</span><span class="p">),</span>
      <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;../updateResult.js&#39;</span><span class="p">)</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">define</span> <span class="o">===</span> <span class="s1">&#39;function&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">define</span><span class="p">.</span><span class="nx">amd</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">define</span><span class="p">(</span>
      <span class="p">[</span><span class="s1">&#39;syncit/Constant&#39;</span><span class="p">,</span><span class="s1">&#39;syncit/updateResult&#39;</span><span class="p">],</span>
      <span class="nx">factory</span>
    <span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">root</span><span class="p">.</span><span class="nx">SyncIt_ServerPersist_MemoryAsync</span> <span class="o">=</span> <span class="nx">factory</span><span class="p">(</span>
      <span class="nx">root</span><span class="p">.</span><span class="nx">SyncIt_Constant</span><span class="p">,</span>
      <span class="nx">root</span><span class="p">.</span><span class="nx">SyncIt_updateResult</span>
    <span class="p">);</span>
  <span class="p">}</span>
<span class="p">})(</span><span class="k">this</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">,</span><span class="nx">updateResult</span><span class="p">)</span> <span class="p">{</span>
  

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Author: Matthew Forrester <matt_at_keyboardwritescode.com>
Copyright: 2013 Matthew Forrester
License: MIT/BSD-style</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_serverpersist_memoryasync">
  <h2>
    <a href="#syncit_serverpersist_memoryasync" name="syncit_serverpersist_memoryasync" class="pilcrow">&#182;</a>
    SyncIt_ServerPersist_MemoryAsync
  </h2>
</div>

  </div>
  <div class="body"><p>An Asynchronous Memory based Persistance for SyncItTestServ suitable for testing.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>makeLaggy()</strong></p>
  </div>
  <div class="body"><p>Takes a function and makes it Asynchrounous by wrapping it in a <code>setTimeout()</code>.</p>

<p><strong>Parameters</strong></p>

<ul>
<li><strong>@param {} <code>func</code></strong> The function to make Asynchronous.</li>
<li><strong>@param {} <code>factor</code></strong> Will use an asynchronous timeout of <code>([random] * factor</code>) + 2`.</li>
<li><strong>@return {Function}</strong> An Asynchrounous version of the Function.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">makeLaggy</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span><span class="nx">factor</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">args</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">arguments</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
      <span class="nx">func</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="k">this</span><span class="p">,</span><span class="nx">args</span><span class="p">);</span>
    <span class="p">},</span><span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">(</span><span class="nb">Math</span><span class="p">.</span><span class="nx">random</span><span class="p">()</span> <span class="o">*</span> <span class="nx">factor</span><span class="p">)</span> <span class="o">+</span> <span class="mi">2</span><span class="p">);</span>
  <span class="p">};</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>onlyInsert()</strong></p>
  </div>
  <div class="body"><p>Adds a value to the Array <code>d</code> if value.b is one higher than storedValue.b</p>

<p><strong>Parameters</strong></p>

<ul>
<li><strong>@param {Array} <code>d</code></strong> Data - An array</li>
<li><strong>@param {Object} <code>value</code></strong> Must include keys <code>s</code>, <code>k</code> and <code>b</code></li>
<li><strong>@param {Function} <code>done</code></strong> Callback. Signature: <code>function(successful)</code></li>
<li><strong>@param {Boolean} <code>done.successful</code></strong> True if the value was wrote, false otherwise.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">onlyInsert</span> <span class="o">=</span> <span class="nx">makeLaggy</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">value</span><span class="p">,</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">findHighestInstant</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span> <span class="p">{</span><span class="nx">s</span><span class="o">:</span><span class="nx">value</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span><span class="nx">k</span><span class="o">:</span><span class="nx">value</span><span class="p">.</span><span class="nx">k</span><span class="p">},</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span><span class="nx">storedQueueitem</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">value</span><span class="p">.</span><span class="nx">b</span> <span class="o">==</span> <span class="p">(((</span><span class="nx">storedQueueitem</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="o">?</span> <span class="o">-</span><span class="mi">1</span> <span class="o">:</span> <span class="nx">storedQueueitem</span><span class="p">.</span><span class="nx">b</span><span class="p">))</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">d</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">value</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
  <span class="p">});</span>
<span class="p">},</span><span class="mi">100</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>filterFunc()</strong></p>
  </div>
  <div class="body"><p>Will return true if <code>item</code> has the same keys with values as <code>filter</code>.</p>

<p><strong>Parameters</strong></p>

<ul>
<li><strong>@param {Queueitem} <code>item</code></strong> Must <code>have all the</code>** keys in <code>filter</code> with the same values.</li>
<li><strong>@param {Object} <code>filter</code></strong></li>
<li><strong>@return {Boolean}</strong> True if it matches.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">filterFunc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">item</span><span class="p">,</span><span class="nx">filter</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">filterkeys</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">filter</span><span class="p">),</span>
    <span class="nx">filterkeysL</span> <span class="o">=</span> <span class="nx">filterkeys</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="nx">filterkeysI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  
  <span class="k">for</span> <span class="p">(</span><span class="nx">filterkeysI</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">filterkeysI</span><span class="o">&lt;</span><span class="nx">filterkeysL</span><span class="p">;</span> <span class="nx">filterkeysI</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">item</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">filterkeys</span><span class="p">[</span><span class="nx">filterkeysI</span><span class="p">]))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">item</span><span class="p">[</span><span class="nx">filterkeys</span><span class="p">[</span><span class="nx">filterkeysI</span><span class="p">]]</span> <span class="o">!=</span> <span class="nx">filter</span><span class="p">[</span><span class="nx">filterkeys</span><span class="p">[</span><span class="nx">filterkeysI</span><span class="p">]])</span> <span class="p">{</span>
      <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>findHighestInstant()</strong></p>
  </div>
  <div class="body"><p>Scans <code>d</code> for data that matches the filter <code>filter</code> and returns the item with the highest field <code>field</code>.</p>

<p><strong>Parameters</strong></p>

<ul>
<li><strong>@param {Array} <code>d</code></strong> should be <code>this._d</code></li>
<li><strong>@param {Object} <code>filter</code></strong> Takes the form of an object, for example <code>{field_i_want: to_have_this_value}</code>.</li>
<li><strong>@param {String} <code>field</code></strong> The field that you are looking to have the highest Number of.</li>
<li><strong>@param {Function} <code>done</code></strong> Signature: <code>function (successful, highestObject)</code></li>
<li><strong>@param {Boolean} <code>done.successful</code></strong> True on success</li>
<li><strong>@param {Queueitem} <code>done.highestObject</code></strong> The data which matches <code>filter</code> with the highest <code>field</code>.</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">findHighestInstant</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">filter</span><span class="p">,</span><span class="nx">field</span><span class="p">,</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">storekeysL</span> <span class="o">=</span> <span class="nx">d</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span>
    <span class="nx">storekeysI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="nx">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
    <span class="nx">highest</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    
  <span class="k">for</span> <span class="p">(</span><span class="nx">storekeysI</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">storekeysI</span><span class="o">&lt;</span><span class="nx">storekeysL</span><span class="p">;</span> <span class="nx">storekeysI</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">ok</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">d</span><span class="p">[</span><span class="nx">storekeysI</span><span class="p">].</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">field</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">filterFunc</span><span class="p">(</span><span class="nx">d</span><span class="p">[</span><span class="nx">storekeysI</span><span class="p">],</span><span class="nx">filter</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">continue</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">((</span><span class="nx">highest</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span> <span class="nx">highest</span><span class="p">[</span><span class="nx">field</span><span class="p">]</span> <span class="o">&lt;</span> <span class="nx">d</span><span class="p">[</span><span class="nx">storekeysI</span><span class="p">][</span><span class="nx">field</span><span class="p">])</span> <span class="p">{</span>
      <span class="nx">highest</span> <span class="o">=</span> <span class="nx">d</span><span class="p">[</span><span class="nx">storekeysI</span><span class="p">];</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span><span class="nx">highest</span><span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>findHighest()</strong></p>
  </div>
  <div class="body"><p>Laggy version of findHighestInstant.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">findHighest</span> <span class="o">=</span> <span class="nx">makeLaggy</span><span class="p">(</span><span class="nx">findHighestInstant</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<div class="dox">
  <div class="summary"><p><strong>getIdFromQueueitem()</strong></p>
  </div>
  <div class="body"><p>Returns a unique (to the server) identifier for a Queueitem.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="kd">var</span> <span class="nx">getIdFromQueueitem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">s</span><span class="o">+</span><span class="s1">&#39;.&#39;</span><span class="o">+</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">k</span><span class="o">+</span><span class="s1">&#39;@&#39;</span><span class="o">+</span><span class="p">(</span><span class="nb">parseInt</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">b</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">var</span> <span class="nx">SyncIt_ServerPersist_MemoryAsync</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cloneFunc</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">this</span><span class="p">.</span><span class="nx">_d</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_cloneFunc</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_cloneFunc</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">v</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">v</span><span class="p">));</span>
    <span class="p">};</span>
  <span class="p">}</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary"><p><strong>SyncIt_ServerPersist_MemoryAsync.getDatasetNames()</strong></p>
  </div>
  <div class="body">
<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Function} <code>done</code></strong> Signature: <code>function (err, datasetNames)</code>
<ul><li><strong>@param {Errorcode} <code>done.err</code></strong></li>
<li><strong>@param {Array} <code>done.datasetNames</code></strong> The names of all Dataset</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt_ServerPersist_MemoryAsync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getDatasetNames</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="p">(</span><span class="nx">makeLaggy</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="kd">var</span> <span class="nx">n</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">l</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">n</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">s</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">r</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">n</span><span class="p">)</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="p">{</span> <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">n</span><span class="p">);</span> <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">r</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="mi">200</span><span class="p">))();</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_serverpersist_memoryasync.getqueueitem()">
  <h3>
    <a href="#syncit_serverpersist_memoryasync.getqueueitem()" name="syncit_serverpersist_memoryasync.getqueueitem()" class="pilcrow">&#182;</a>
    SyncIt_ServerPersist_MemoryAsync.getQueueitem()
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>dataset</code></strong></li>
<li><strong>@param {Number|null} <code>fromVersion</code></strong> Where to read Queueitem from (not inclusive).</li>
<li><strong>@param {Function} <code>done</code></strong> Signature: <code>done(err, queueitems, lastQueueitemIdentifier)</code>
<ul><li><strong>@param {Number} <code>done.err</code></strong> See SyncIt_Constant.Error</li>
<li><strong>@param {Array} <code>done.queueitems</code></strong> An array of Queueitem</li>
<li><strong>@param {Object} <code>done.lastQueueitemIdentifier</code></strong> The internal reference of that last item, passing this to this function again will lead to continual reading.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt_ServerPersist_MemoryAsync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getQueueitem</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">fromVersion</span><span class="p">,</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[];</span>
  
  <span class="p">(</span><span class="nx">makeLaggy</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="p">[],</span>
      <span class="nx">l</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
      <span class="nx">lastId</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
      <span class="nx">foundFirst</span> <span class="o">=</span> <span class="p">(</span>
          <span class="p">(</span><span class="nx">fromVersion</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="o">||</span>
          <span class="p">(</span><span class="nx">fromVersion</span> <span class="o">===</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">||</span>
          <span class="p">(</span><span class="nx">fromVersion</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="p">)</span> <span class="o">?</span> <span class="kc">true</span> <span class="o">:</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span>
      <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="nx">l</span><span class="o">=</span><span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
      <span class="nx">i</span><span class="o">&lt;</span><span class="nx">l</span><span class="p">;</span>
      <span class="nx">i</span><span class="o">++</span>
    <span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">foundFirst</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">s</span> <span class="o">==</span> <span class="nx">dataset</span><span class="p">))</span> <span class="p">{</span>
        <span class="nx">r</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
          <span class="nx">s</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">s</span><span class="p">,</span>
          <span class="nx">k</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">k</span><span class="p">,</span>
          <span class="nx">b</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">b</span><span class="p">,</span>
          <span class="nx">m</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">m</span><span class="p">,</span>
          <span class="nx">r</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">r</span><span class="p">,</span>
          <span class="nx">u</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">u</span><span class="p">,</span>
          <span class="nx">o</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">o</span><span class="p">,</span>
          <span class="nx">t</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">t</span>
        <span class="p">});</span>
      <span class="p">}</span>
      <span class="nx">lastId</span> <span class="o">=</span> <span class="nx">getIdFromQueueitem</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">lastId</span> <span class="o">==</span> <span class="nx">fromVersion</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">foundFirst</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span> <span class="nx">r</span><span class="p">,</span> <span class="nx">lastId</span><span class="p">);</span>
  <span class="p">}.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">),</span><span class="mi">200</span><span class="p">))();</span>
  
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_serverpersist_memoryasync.getvalue()">
  <h3>
    <a href="#syncit_serverpersist_memoryasync.getvalue()" name="syncit_serverpersist_memoryasync.getvalue()" class="pilcrow">&#182;</a>
    SyncIt_ServerPersist_MemoryAsync.getValue()
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {String} <code>dataset</code></strong></li>
<li><strong>@param {String} <code>datakey</code></strong></li>
<li><strong>@param {Function} <code>done</code></strong> Signature: <code>function (err, jrec)</code>
<ul><li><strong>@param {Number} <code>done.err</code></strong> See SyncIt_Constant.Error</li>
<li><strong>@param {Jrec} <code>done.jrec</code></strong> The result of all the Queueitem.</li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt_ServerPersist_MemoryAsync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getValue</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">dataset</span><span class="p">,</span><span class="nx">datakey</span><span class="p">,</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">findHighest</span><span class="p">(</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_d</span><span class="p">,</span>
    <span class="p">{</span><span class="nx">s</span><span class="o">:</span><span class="nx">dataset</span><span class="p">,</span> <span class="nx">k</span><span class="o">:</span><span class="nx">datakey</span><span class="p">},</span>
    <span class="s1">&#39;b&#39;</span><span class="p">,</span>
    <span class="kd">function</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span><span class="nx">storedQueueitem</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;findHighest did not return properly&quot;</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">storedQueueitem</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">NO_DATA_FOUND</span><span class="p">);</span>
      <span class="p">}</span>
      <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span><span class="nx">storedQueueitem</span><span class="p">.</span><span class="nx">j</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">);</span>
<span class="p">};</span>


</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="syncit_serverpersist_memoryasync.push()">
  <h3>
    <a href="#syncit_serverpersist_memoryasync.push()" name="syncit_serverpersist_memoryasync.push()" class="pilcrow">&#182;</a>
    SyncIt_ServerPersist_MemoryAsync.push()
  </h3>
</div>

  </div>
  <div class="body">
<div class="pilwrap" id="parameters">
  <h4>
    <a href="#parameters" name="parameters" class="pilcrow">&#182;</a>
    Parameters
  </h4>
</div>


<ul>
<li><strong>@param {Queueitem} <code>queueitem</code></strong></li>
<li><strong>@param {Function} <code>done</code></strong> Signature: <code>function (err, queueitem, jrec)</code>
<ul><li><strong>@param {Number} <code>done.err</code></strong> See SyncIt_Constant.Error</li>
<li><strong>@param {Queueitem} <code>done.queueitem</code></strong> The Queueitem passed in (successful or not)</li>
<li><strong>@param {Jrec} <code>done.jrec</code></strong> If successul, a Jrec, otherwise <code>undefined</code></li></ul></li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
<span class="nx">SyncIt_ServerPersist_MemoryAsync</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">push</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">,</span><span class="nx">done</span><span class="p">)</span> <span class="p">{</span>
  
  <span class="kd">var</span> <span class="nx">inst</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">attempts</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
  
  <span class="kd">var</span> <span class="nx">doIt</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    
    <span class="nx">findHighest</span><span class="p">(</span>
      <span class="nx">inst</span><span class="p">.</span><span class="nx">_d</span><span class="p">,</span>
      <span class="p">{</span><span class="s2">&quot;s&quot;</span><span class="o">:</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span><span class="s2">&quot;k&quot;</span><span class="o">:</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">},</span>
      <span class="s1">&#39;b&#39;</span><span class="p">,</span>
      <span class="kd">function</span><span class="p">(</span><span class="nx">success</span><span class="p">,</span><span class="nx">storedQueueitem</span><span class="p">)</span> <span class="p">{</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>The starting queueitem (previous which does not exist) is 
based on -1, because the first queueitem would be based on 0.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="kd">var</span> <span class="nx">highestBasedOn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
          <span class="nx">resultingJrec</span><span class="p">;</span>
          
        <span class="kd">var</span> <span class="nx">_getEmptyJrec</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
          <span class="k">return</span> <span class="p">{</span>
            <span class="nx">i</span><span class="o">:</span><span class="p">{},</span>
            <span class="nx">v</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="nx">r</span><span class="o">:</span><span class="kc">false</span><span class="p">,</span>
            <span class="nx">t</span><span class="o">:</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">()).</span><span class="nx">getTime</span><span class="p">(),</span>
            <span class="nx">m</span><span class="o">:</span><span class="kc">null</span>
          <span class="p">};</span>
        <span class="p">};</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;findHighest did not return properly&quot;</span><span class="p">);</span>
        <span class="p">}</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>If there is something stored at that dataset/datakey we want
a to look for one over that based on.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">storedQueueitem</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">highestBasedOn</span> <span class="o">=</span> <span class="nx">storedQueueitem</span><span class="p">.</span><span class="nx">b</span><span class="p">;</span>
        <span class="p">}</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>Check that we have not been given a future queueitem.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">b</span> <span class="o">&gt;</span> <span class="nx">highestBasedOn</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_ADD_FUTURE_QUEUEITEM</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">);</span>
        <span class="p">}</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Check that we are not adding a out of data queueitem</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">(</span><span class="nx">queueitem</span><span class="p">.</span><span class="nx">b</span> <span class="o">&lt;=</span> <span class="nx">highestBasedOn</span><span class="p">)</span> <span class="p">{</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18">&#182;</a>
</div>
<p>If we are, it is the last one with the same modifier and 
basedonversion then we send something about it being
a duplicate.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">if</span> <span class="p">((</span><span class="nx">storedQueueitem</span><span class="p">.</span><span class="nx">m</span> <span class="o">==</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">m</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">storedQueueitem</span><span class="p">.</span><span class="nx">b</span> <span class="o">==</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">b</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_ADD_ALREADY_ADDED_QUEUEITEM</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">);</span>
          <span class="p">}</span>

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19">&#182;</a>
</div>
<p>otherwise send back just a normal version conflict error.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
          <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">TRYING_TO_ADD_QUEUEITEM_BASED_ON_OLD_VERSION</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">);</span>
        <span class="p">}</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20">&#182;</a>
</div>
<p>If we have a stored queueitem which had a remove operation, 
the item will always stay removed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="k">if</span> <span class="p">((</span><span class="nx">storedQueueitem</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">storedQueueitem</span><span class="p">.</span><span class="nx">o</span> <span class="o">==</span> <span class="s1">&#39;remove&#39;</span><span class="p">))</span> <span class="p">{</span>
          <span class="k">return</span> <span class="nx">done</span><span class="p">(</span><span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">DATA_ALREADY_REMOVED</span><span class="p">,</span><span class="nx">queueitem</span><span class="p">);</span>
        <span class="p">}</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21">&#182;</a>
</div>
<p>Calculate the result</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">resultingJrec</span> <span class="o">=</span> <span class="nx">updateResult</span><span class="p">(</span>
          <span class="p">(</span><span class="nx">storedQueueitem</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="o">?</span> <span class="nx">_getEmptyJrec</span><span class="p">()</span> <span class="o">:</span> <span class="nx">storedQueueitem</span><span class="p">.</span><span class="nx">j</span><span class="p">,</span>
          <span class="nx">queueitem</span><span class="p">,</span>
          <span class="nx">inst</span><span class="p">.</span><span class="nx">_cloneFunc</span>
        <span class="p">);</span>
        

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22">&#182;</a>
</div>
<p>Try and insert the record.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
        <span class="nx">onlyInsert</span><span class="p">(</span>
          <span class="nx">inst</span><span class="p">.</span><span class="nx">_d</span><span class="p">,</span>
          <span class="p">{</span>
            <span class="nx">s</span><span class="o">:</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">s</span><span class="p">,</span>
            <span class="nx">k</span><span class="o">:</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">k</span><span class="p">,</span>
            <span class="nx">b</span><span class="o">:</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">b</span><span class="p">,</span>
            <span class="nx">m</span><span class="o">:</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">m</span><span class="p">,</span>
            <span class="nx">r</span><span class="o">:</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">r</span><span class="p">,</span>
            <span class="nx">u</span><span class="o">:</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">u</span><span class="p">,</span>
            <span class="nx">o</span><span class="o">:</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">o</span><span class="p">,</span>
            <span class="nx">t</span><span class="o">:</span> <span class="nx">queueitem</span><span class="p">.</span><span class="nx">t</span><span class="p">,</span>
            <span class="nx">j</span><span class="o">:</span> <span class="nx">resultingJrec</span>
          <span class="p">},</span>
          <span class="kd">function</span><span class="p">(</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
            

</pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23">&#182;</a>
</div>
<p>If it passed all the tests above, but was not 
successful writing, it might well be that we are in
some form or race condition... going around again
should pick up the real reason.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">success</span><span class="p">)</span> <span class="p">{</span>
              <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="nx">attempts</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s2">&quot;SyncIt_ServerPersist_MemoryAsync.push(): Maximum number attempts used.&quot;</span><span class="p">);</span>
              <span class="p">}</span>
              <span class="k">return</span> <span class="nx">doIt</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="nx">done</span><span class="p">(</span>
              <span class="nx">SyncIt_Constant</span><span class="p">.</span><span class="nb">Error</span><span class="p">.</span><span class="nx">OK</span><span class="p">,</span>
              <span class="nx">queueitem</span><span class="p">,</span>
              <span class="nx">resultingJrec</span><span class="p">,</span>
              <span class="nx">getIdFromQueueitem</span><span class="p">(</span><span class="nx">queueitem</span><span class="p">)</span>
            <span class="p">);</span>
          <span class="p">}</span>
        <span class="p">);</span>
        
      <span class="p">}</span>
    <span class="p">);</span>
  
  <span class="p">};</span>
  
  <span class="nx">doIt</span><span class="p">();</span>
<span class="p">};</span>

<span class="k">return</span> <span class="nx">SyncIt_ServerPersist_MemoryAsync</span><span class="p">;</span>
  
<span class="p">});</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
